# This file is auto-generated.
# Do not modify directly.
# ---
networks:
  localdockerstacknetwork:
    driver: bridge
services:
  queueservice819a1fca:
    image: softwaremill/elasticmq-native:latest
    command: /bin/sh -c "echo 'include
      classpath(\"application.conf\")\n\nnode-address {\n    protocol =
      http\n    host = \"*\"\n    port = 9324\n    context-path =
      \"\"\n}\n\nrest-sqs {\n    enabled = true\n    bind-port =
      9324\n    bind-hostname = \"0.0.0.0\"\n    sqs-limits =
      strict\n}\n\nqueues {\n    e6f21583 {\n        defaultVisibilityTimeout =
      10 seconds\n        delay = 0 seconds\n        receiveMessageWait = 0
      seconds\n    }\n}' > /elastic.conf && java -Dconfig.file=/elastic.conf
      -jar /opt/elasticmq-server.jar"
    privileged: false
    deploy:
      mode: replicated
      replicas: 1
    ports:
      - 9324:9324
    networks:
      localdockerstacknetwork:
        aliases:
          - sqs.local
  storagebucketa8622c71:
    image: minio/minio:latest
    command: -c 'mkdir -p /data/46b6c6fb && /usr/bin/minio server /data'
    entrypoint: /bin/sh
    privileged: false
    deploy:
      mode: replicated
      replicas: 1
    environment:
      MINIO_ROOT_USER: test
      MINIO_ROOT_PASSWORD: test
    ports:
      - 9000:9000
    volumes:
      - type: bind
        source: ../.s3/46b6c6fb
        target: /data
    networks:
      localdockerstacknetwork:
        aliases:
          - s3.local
  postgreslocal:
    image: postgres:latest
    command: postgres
    privileged: false
    deploy:
      mode: replicated
      replicas: 1
    environment:
      POSTGRES_DB: wavekb-local
      POSTGRES_USER: wavekb
      POSTGRES_PASSWORD: local
      POSTGRES_HOST_AUTH_METHOD: trust
    ports:
      - 5432:5432
    volumes:
      - type: bind
        source: ../.postgres
        target: /var/lib/postgresql/data
    networks:
      localdockerstacknetwork:
        aliases:
          - postgres.local
    healthcheck:
      test:
        - CMD-SHELL
        - pg_isready -U wavekb
      interval: 10s
      timeout: 5s
      retries: 5
  triggerscript4f77d86b:
    working_dir: /c5f2eb21
    image: node:alpine
    command: -e 'require("./index.ts").handler()'
    privileged: false
    restart: no
    deploy:
      mode: replicated
      replicas: 1
    volumes:
      - type: bind
        source: ../triggers/seed
        target: /c5f2eb21
    depends_on:
      postgreslocal:
        condition: service_healthy
  nextjslocal:
    image: node:alpine
    user: "1000"
    command: sh -c 'cd /app && npm run dev'
    privileged: false
    deploy:
      mode: replicated
      replicas: 1
    environment:
      DEBUG: wavekb*
      PORT: "4000"
      QUEUE_URL: http://sqs.local:9324/e6f21583
      STORAGE_URL: http://s3.local:9000/46b6c6fb
      POSTGRES_URL: postgres://wavekb:local@postgres.local/wavekb-local
      FRAMEWORK_ENVIRONMENT: development
    ports:
      - 4000:4000
    volumes:
      - type: bind
        source: ../app
        target: /app
    networks:
      localdockerstacknetwork:
        aliases:
          - nextjs.local
    healthcheck:
      test:
        - CMD-SHELL
        - curl --fail http://localhost:4000/api/healthcheck || exit 1
      interval: 10s
      timeout: 5s
      retries: 5
    depends_on:
      triggerscript4f77d86b:
        condition: service_completed_successfully
name: localdockerstackproject
